export MKL_NUM_THREADS=12
export OMP_NUM_THREADS=12
export CAFFE_PREDICT_DEVICEID=0
cd so
rm -f libcaffewrapper.so
export LD_LIBRARY_PATH=/home/work/cuda-6.5/lib64:$LD_LIBRARY_PATH
ln -s libcaffegpu_cuda65.so libcaffewrapper.so
cd ..

modelName="_"$1
is_rotated_gt="1"
#evaluationSet="rand_3w"
#evaluationSet="FDDB"
evaluationSet="videoData_baidu"

if [ "$evaluationSet" == "rand_3w" ]  
  then
  echo "evaluate the dataset--rand_3w"
  evaluationDataDir="/home/vis/dukang/data/IDL_FaceData/faceDetectionEvaluation/"
  testImgList=${evaluationDataDir}"rand_3w.list"
  testImgDir=${evaluationDataDir}"rand_3w_imgs/"
  testImgGroundTruth=${evaluationDataDir}"rand_3w.gt"
  detectionRes="./data/rand_3w_det${modelName}.res"
  evaluationRes="./data/rand_3w_evaluation${modelName}.res"
  needDetectAgain=1
  overlapThreshold=0.5
  needSaveRes=0
  saveDir="./data/rand_3w_res_tmp/"
fi

if [ "$evaluationSet" == "FDDB" ]  
  then
  echo "evaluate the dataset--FDDB"
  evaluationDataDir="/home/vis/dukang/data/IDL_FaceData/faceDetectionEvaluation/"
  testImgList=${evaluationDataDir}"FDDB_raw.list"
  testImgDir=${evaluationDataDir}"FDDB_test/"
  testImgGroundTruth=${evaluationDataDir}"FDDB_GroundTruth.rawrectangle"
  detectionRes="./data/fddb_det${modelName}.res"
  evaluationRes="./data/fddb_evaluation${modelName}.res"
  needDetectAgain=1
  overlapThreshold=0.5
  needSaveRes=0
  is_rotated_gt="0"
  saveDir="./data/fddb_res_tmp/"
fi

if [ "$evaluationSet" == "shendazhaji" ]  
  then
  echo "evaluate the dataset--shendazhaji"
  evaluationDataDir="/home/vis/dukang/data/IDL_FaceData/faceDetectionEvaluation/"
  testImgList=${evaluationDataDir}"zhaji.list"
  testImgDir=${evaluationDataDir}"zhaji_imgs/"
  testImgGroundTruth=${evaluationDataDir}"zhaji.gt"
  detectionRes="./data/shenda_zhaji_det${modelName}.res"
  evaluationRes="./data/shenda_zhaji_evaluation${modelName}.res"
  needDetectAgain=1
  overlapThreshold=0.5
  needSaveRes=0
  saveDir="./data/shenda_zhaji_res_tmp/"
fi

if [ "$evaluationSet" == "surveillanceVideo" ]  
  then
  echo "evaluate the dataset--surveillanceVideo"
  testImgDir="/home/vis/zhufuguo/IDL_faceData/surveillanceVideo/TianAnMen/20150410/10.20.1.9_8000_1_115_-1/20150410_092359/"
  testImgDir="/home/vis/zhufuguo/IDL_faceData/surveillanceVideo/HaiXin/VideoJoiner161017165513/"
  testImgList="./data/surveillanceVideo_10.imgList"
  testImgGroundTruth="./data/surveillanceVideo_10.gtList"
  detectionRes="./data/surveillanceVideo_10_det.res"
  evaluationRes="./data/surveillanceVideo_10_evaluation.res"
  needDetectAgain=0
  overlapThreshold=0.5
  needSaveRes=1
  is_rotated_gt="0"
  saveDir="./data/surveillanceVideo_10_res_tmp/"
fi

if [ "$evaluationSet" == "multiMode" ]  
  then
  evaluationDataDir="/home/vis/dukang/data/Evaluation/multiModel_2w1/"
  testImgList=${evaluationDataDir}"list"
  testImgDir=${evaluationDataDir}"data/"
  testImgGroundTruth=${evaluationDataDir}"rand_3w.gt"
  detectionRes="./data/rand_3w_det${modelName}.res"
  evaluationRes="./data/rand_3w_evaluation${modelName}.res"
  needDetectAgain=1
  overlapThreshold=0.5
  needSaveRes=0
  is_rotated_gt="0"
  saveDir="./data/rand_3w_res_tmp/"
fi

if [ "$evaluationSet" == "videoData_baidu" ]  
  then
  evaluationDataDir="/home/vis/dukang/data/videoData/test/"
  testImgList=${evaluationDataDir}"video_data_list_only"
  testImgDir=${evaluationDataDir}"data/"
  testImgGroundTruth=${evaluationDataDir}"supervisory_control_data_Rect_2_only.txt"     # need to be generated by Bin He
  detectionRes=${evaluationDataDir}"supervisory_control_data_Rect_predict_with_iou03_only.res"            # given by sdk 
  evaluationRes=${evaluationDataDir}"supervisory_control_data_Rect_evaluation_with_iou03_new_only.res" # output
  needDetectAgain=0
  overlapThreshold=0.3
  needSaveRes=1
  is_rotated_gt="0"
  saveDir=${evaluationDataDir}"supervisory_control_data_Rect_with_iou03_new_only/"
fi


./bin/evaluationDetection_v4 $testImgList $testImgDir $testImgGroundTruth $detectionRes $evaluationRes $needDetectAgain $overlapThreshold $needSaveRes $saveDir $is_rotated_gt

#./bin/evaluationDetection ${evaluationDataDir}FDDB_raw.list ${evaluationDataDir}FDDB_test/ /home/vis/dukang/data/fddb_gt_tmp /home/vis/dukang/data/fddb_det.res_tmp /home/vis/dukang/data/fddb_evaluation.res 1 /home/vis/dukang/data/fddb_res_tmp/
